---
import Container from "../../components/Container.astro";
import RecommendedWork from "../../components/RecommendedWork.astro";
import { recommendedWork } from "../../store";

const rw = recommendedWork.get();

const workList = ["sa", "sppoc", "iomusic", "webapps", "ecomm", "sfm"].map(
  (key: string) => ({
    bgcolor: rw[key].bgcolor,
    image: rw[key].image,
    title: rw[key].title,
    description: rw[key].description,
    link: rw[key].link,
  })
);
---

<section id="work">
  <div class="work-container">
    <Container>
      <div class="work-scroller">
        <div class="work__header">
          <h2>Featured Work</h2>
          <p>A selection of website and app work</p>
        </div>
        <div class="work__body">
          {
            workList.map(
              (work: {
                image: { src: string };
                title: string;
                description: string;
                bgcolor: string;
                link: string;
              }) => (
                <RecommendedWork
                  image={work.image}
                  title={work.title}
                  description={work.description}
                  link={work.link}
                />
              )
            )
          }
        </div>
      </div>
    </Container>
  </div>
</section>

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const tl = gsap.timeline({
    scrollTrigger: {
      trigger: ".work-scroller",
      start: "-5% top",
      end: "+=50%",
      pin: true,
      pinSpacing: false,
      scrub: true,
    },
  });

  tl.to(".work__header h2", {
    opacity: 0,
    filter: "blur(2px)",
    ease: "none",
    duration: 0.2,
  })
    .to(".work__header p", {
      opacity: 0,
      filter: "blur(1px)",
      ease: "none",
      duration: 0.2,
      delay: -0.3,
    })
    .to(".work__body", { y: -500, ease: "none", duration: 1 }, "<");

  window.addEventListener("load", () => ScrollTrigger.refresh());
</script>

<style>
  .work-container {
    align-content: center;
    background-color: oklab(from var(--color-primary) calc(l - 0.05) a b);
    padding: var(--space-xl) 0;
  }

  .work-scroller {
    margin-bottom: var(--space-2xl);
  }

  .work__body {
    --grid-template-columns: 1fr;
  }

  @media screen and (min-width: 540px) {
  }

  @media screen and (min-width: 1280px) {
    .work-container {
      min-height: 100dvh;
    }
  }

  .work__header {
    text-align: center;
    margin-bottom: var(--space-xl);

    > h2,
    > p {
      will-change: opacity, filter;
    }
  }

  .work__header h2 {
    font-size: var(--step-3);
    color: var(--color-onPrimary);
    margin-bottom: var(--space-2xs);
  }

  .work__body {
    margin-top: var(--space-l);
    display: grid;
    grid-template-columns: var(--grid-template-columns);
    gap: var(--space-l);
    place-items: center;
    will-change: transform;
  }

  .work__item {
    border: none;
    padding: 0;
    cursor: pointer;
    width: clamp(240px, 100%, 600px);
    aspect-ratio: 1;
    background-size: 100%;
    background-position: 0% 0%;
    border-radius: var(--border-radius-lg);
    scale: 0.8;
    transition: all 800ms var(--ease-out-elastic);
    overflow: hidden;
    position: relative;
  }

  .work__item > span {
    display: none;
  }

  .work__item[inview] {
    scale: 1;
  }

  .work__item:hover,
  .work__item:focus {
    scale: 1.02;
    mix-blend-mode: initial;
  }

  .work__item:active {
    scale: 0.95;
  }

  .work__item img {
    height: auto;
    object-fit: cover;
    scale: 1.3;
  }
</style>
